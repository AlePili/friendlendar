<div class="event-header">
  <div class="event-card">
    <%  if @event.photo.attached?%>
      <%= cl_image_tag @event.photo.key, width: 400, height: 260, crop: :fill %>
    <% else %>
      <%=  image_tag('event_default.png', width: 400, height: 260, crop: :fill) %>
    <% end %>
    <div class="event-card-infos">
      <div>
        <h1 class="event-card-title"><%= @event.title %></h2>
        <p class="event-card-title"><%= @event.location%></p>
      </div>
      <h2 class="event-card-host"><%= @event.user.first_name %></h2>
      <img src="https://kitt.lewagon.com/placeholder/users/krokrob" class="card-user avatar-bordered" />
    </div>
</div>
<div class="container">
  <div class="row event-details">
    <div class="col-md-8">
      <h2 class="event-details">Details</h2>
      <% sentences=@event.description.split("\n") %>
      <% sentences.each do |sentence| %>
      <p class="event-details"><%= sentence.strip %></p>
      <% end %>
    </div>
    <div class="event-location col-4">
     <div class="event-location-card">
      <p>📍<%= @event.location %></p>
      <p>🗓 <%= @event.start_time %> to <%= @event.end_time %></p>
      <p>👫 <%= @event.availability %> friends can join me</p>
     </div>
     <div class="event-attend-button">
      <% if @event.user == current_user %>
        <h3>Invite your friends</h3>
        <%= simple_form_for([@event, @invitation])do |f| %>
        <%= f.input :user_id, collection: User.all %>
        <%= f.submit "Invite", class: "btn btn-flat-secondary" %>
        <% end %>
        <% else %>
        <h3>Join this event</h3>
        <%= simple_form_for([@event, @invitation])do |f| %>
        <%= f.hidden_field :user_id, :value => current_user.id  %>
        <%= f.submit "Join" if @event.invitations.where(user_id: current_user).empty? %>
        <% end %>
       <% end %>
     </div>
     <div class="event-attendees-card">
      <h2>All attendees</h2>
        <% @event.invitations.each do |invitation| %>
          <% if invitation.status == "approved" %>
            <%= cl_image_tag invitation.user.photo.key, width: 40, height: 40, class: "avatar dropdown-toggle" %>
            <% end %>
          <% end %>
     </div>
    </div>
  </div>

  <h2>All attendees</h2>

      <% @event.invitations.each do |invitation| %>
      <% if invitation.status == "approved" %>
      <%= cl_image_tag invitation.user.photo.key, width: 40, height: 40, class: "avatar dropdown-toggle" %>
      <% end %>
       <% end %>

  <% if @event.user == current_user %>
    <% @event.invitations.each do |invitation| %>
      <%= invitation.user.email %>
      <%= invitation.status %>

      <%= simple_form_for [@event, invitation] do |f| %>
        <%= f.hidden_field :status, value: "approved" %>
        <%= f.submit "Attend event", class: "btn btn-primary" %>
      <% end %>
    <% end %>
  <% end %>
</div>
